# Telegram-бот магазин на основе API от [Elastic Path](https://www.elasticpath.com)

### 1. Общее описание 

### 2. Подготовительные работы

Для успешного запуска системы необходимо подготовить следующее:   
2.1 Все работает на Python 3.8 или выше  
2.2 скопируйте текущий репозиторий
```shell
git clone https://github.com/Sam1808/Fish_shop_bot.git
```
2.3 Python окружение с установленными зависимостями согласно `requirements.txt`
```shell
pip install -r requirements.txt
```
2.4 Файл `.env` со следующим содержимым
```text
# Данные от Elastic Path
CLIENT_ID=ваш клиент id
CLIENT_SECRET=ваш Elastic ключ
# URL API интерфейса от Elastic Path (необязательный параметр)
API_BASE_URL=https://api.moltin.com

# Токен телеграм бота полученный через Отца ботов
TELEGRAM-TOKEN=ваш токен

# Доступ к базе данных Redis
REDIS-BASE=полное имя базы данных
REDIS-PORT=порт базы данных
REDIS-PASSWORD=пароль к базе данных
```
2.5 Добавьте в папку `images` фото ваших товаров.

### 3. Подготавливаем данные в [Elastic Path](https://www.elasticpath.com) для работы магазина

Для работы магазина нам нужны данные. Пришлось разработать отдельный файл методов для работы с API от Elastic Path. 
<hr>

Все методы собраны в файле `shop_utils.py`. Список реализованных методов (примеры и описание):

- `add_product_to_cart(cart_id=098765, product_id=123-45345-6546, quantity=5`)  

Добавляет *существующий* товар в корзину с определенным id, на основании id товара и необходимого количества.

- `create_a_file(folder_name='images')`

Загружает файлы из папки `images` в систему Elastic Path, загруженные файлы помечает как `.uploaded`. Вы можете указать другую папку с файлами.
Возвращает строку с указанием количества загруженных файлов и их списком.
- `create_a_customer(name=Jimm Smith, email=js@hismail.com)`.
 
Создает покупателя в базе данных Elastic Path, присваевает ему id. 
Поля для пароля не предусмотрено, но его можно легко дописать согласно [документации](https://documentation.elasticpath.com/commerce-cloud/docs/api/customers-and-accounts/customers/create-a-customer.html).
- `create_main_image_relationship(product_id=123-45687-456, image_id=987523-123123)`.

Привязывает к *существующему* товару *существующую* (ранее загруженную как файл) картинку, как основное изображение товара.
- `get_actual_token()`.

Функция получения актуального токена для работы с методами, основывается на `CLIENT_ID` и `CLIENT_SECRET`.
- `get_a_customers(customer_id=None)`

Функция для получения списка всех существующих покупателей, или описания конкретного покупателя согласно его id, т.об. `get_a_customers(customer_id=025245-4156456-454)`
- `get_files(file_id=None)`

Метод получения списка всех загруженных файлов или описания конкретного файла по его ID
- `get_cart_status(card_id, items=False)`

Получаем статус корзины по ее ID. Если необходимо, получаем корзину и список товаров в ней, т.об.`get_cart_status(card_id, items=True)`
- `get_products(product_id=None)`

Получаем список всех товаров или конкретного товара по его id. 
- `remove_item_from_cart(card_id=45646-46546, product_id=1341563-4546)`

Удаление из конкретной корзины (на основе ее id), конкретного товара.
<hr>

Все методы возвращают JSON данные, если явно не указано другое.  
Логгирование не предусмотрено, возможно *пока*.  
Методы задекорированы как `@retry`, на 3 попытки с перерывом в 1 секунду. API все таки притормаживают.

Таким образом, для работы магазина убедитесь, что у вас пройдены следующие шаги: 
1. Получите учетную запись [Elastic Path](https://www.elasticpath.com), создайте `store` если необходимо.
2. Создайте товары, с заполнением всех обязательных полей (ручной труд).
3. С помощью описанных методов загрузите картинки для товаров и свяжите их с товарами.
4. Вы почти на финише :)

### 3. Описание и запуск Telegram бота.

### 4. Примеры

### 5. Известные проблемы